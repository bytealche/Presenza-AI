(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,36063,e=>{"use strict";var t=e.i(43476),r=e.i(71645);function n(){let e=new URLSearchParams(window.location.search).get("id"),n=(0,r.useRef)(null),s=(0,r.useRef)(null),i=(0,r.useRef)(null),[o,a]=(0,r.useState)("Initializing..."),[c,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>e?(l(),u(),()=>{i.current&&i.current.close()}):void a("No camera id provided. Use ?id=<camera_id> to stream."),[e]);let l=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:640,height:480},audio:!1});n.current&&(n.current.srcObject=e)}catch(t){let e="Error accessing camera: "+(t.message||t.name);a(e),i.current&&i.current.readyState===WebSocket.OPEN&&i.current.send(JSON.stringify({type:"error",message:e}))}},u=()=>{if(!e)return;let t="https:"===window.location.protocol?"wss:":"ws:",r=new WebSocket(`${t}//${window.location.hostname}:8000/ws/stream/${e}?client_type=sender`);r.onopen=()=>{a("Connected to server"),d(!0),r.send(JSON.stringify({type:"log",message:"Mobile WS Connected - JS Running"})),m(r)},r.onclose=()=>{a("Disconnected. Reconnecting..."),d(!1),setTimeout(u,2e3)},r.onerror=e=>{console.error(e),a("Connection Error")},i.current=r},m=e=>{let t=()=>{if(e.readyState!==WebSocket.OPEN||!n.current||!s.current)return;let r=n.current,i=s.current,o=i.getContext("2d");o&&r.videoWidth>0&&(i.width=r.videoWidth,i.height=r.videoHeight,o.drawImage(r,0,0,i.width,i.height),i.toBlob(t=>{t&&e.readyState===WebSocket.OPEN&&e.send(t)},"image/jpeg",.5)),requestAnimationFrame(t)};t()};return(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-black text-white p-4",children:[(0,t.jsx)("h1",{className:"text-xl font-bold mb-4",children:"Mobile Broadcaster"}),(0,t.jsxs)("div",{className:`px-4 py-2 rounded mb-4 ${c?"bg-green-600":"bg-red-600"}`,children:["Status: ",o]}),(0,t.jsx)("div",{className:"relative w-full max-w-lg aspect-video bg-gray-800 rounded overflow-hidden",children:(0,t.jsx)("video",{ref:n,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"})}),(0,t.jsx)("p",{className:"mt-4 text-sm text-gray-400",children:"Keep this screen open to stream."}),(0,t.jsx)("canvas",{ref:s,className:"hidden"})]})}e.s(["default",()=>n])}]);